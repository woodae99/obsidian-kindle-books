/* Copyright (c) 2025 Amazon.com, Inc. or its affiliates. All Rights Reserved. */
define("kp.min",function(){}),define("modules/errors/JqueryPromiseErrorHandler",["require","exports"],function(e,t){"use strict";function n(e){throw"object"!=typeof e?(alert("JQueryPromiseErrorHandler was passed a non-object error argument! Please review your code: we should always pass/throw a new Error() object in order to get the best possible call stacks in our metrics."),new Error(e)):null===e?new Error("JQuery Promise rejection"):e}t.onPromiseRejected=n}),define("modules/metrics/ReadingStreams",["require","exports"],function(e,t){"use strict";function n(){return i||(i=new s),i}var i,r="Unknown",o=function(){function e(){}return e.OpenContext="OpenContext",e.ShowContext="ShowContext",e.HideContext="HideContext",e.OpenContent="OpenContent",e.Action="Action",e.ContentAction="ContentAction",e.ConsumeContentSpan="ConsumeContentSpan",e.ConsumeContentPoint="ConsumeContentPoint",e.AuxContentState="AuxContentState",e.Metadata="Metadata",e.SettingState="SettingState",e}();t.EventTypes=o;var a=function(){function e(){}return e.CONTEXT_KP="KindlePlayerClient",e.CONTEXT_KSHARE="KShare",e.CONTEXT_KSHARE_LANDING_PAGE_LOADED="KShareLandingPageLoaded",e.CONTEXT_KSHARE_LANDING_PAGE="KShareLandingPage",e.CONTEXT_KSHARE_END_ACTION="KShareEndAction",e.CONTEXT_COVER_PAGE="CoverPage",e.CONTEXT_READER="Reader",e.CONTEXT_PRE_AUTH="KSharePreAuth",e.CONTEXT_POST_AUTH="KSharePostAuth",e.CONTEXT_RIK_INTERSTITIAL="KShareRikInterstitial",e.CONTEXT_RIK_DESKTOP="RIKDesktop",e.CONTEXT_TEXT_ME="TextMe",e.CONTEXT_UNSUPPORTED_BROWSER="UnsupportedBrowser",e.CONTEXT_SHARING_DIALOG="SharingDialog",e.CONTEXT_ERROR_DIALOG="ErrorDialog",e.CONTEXT_PAGE_LOADED="KindlePlayerPageLoaded",e.CONTEXT_PDOC_SHARE_PAGE="PDocQuoteSharePage",e.ERROR_DP_URL_NOT_CONFIGURED="DetailPageUrlNotConfigured",e.ACTION_SCROLL="Scroll",e.ACTION_END_ACTION_BACK_BUTTON_CLICKED="BackClicked",e.ACTION_LEARN_MORE_CLICKED="LearnMoreClicked",e.ACTION_VIEW_FULL_DETAILS_CLICKED="ViewFullDetailsClicked",e.ACTION_NAVIGATION_ATTEMPT_PAST_BOOK_END="NavigationAttemptPastBookEnd",e.ACTION_CLOSE_BUTTON_CLICKED="CloseClicked",e.ACTION_OVERLAY_CLICKED="OverlayClicked",e.ACTION_PREVIEW_BOOK_BUTTON_CLICKED="PreviewBookClicked",e.ACTION_LANDING_PAGE_SWIPE_LEFT="LandingPageSwipeLeft",e.ACTION_END_ACTION_SWIPE_RIGHT="EndActionSwipeRight",e.ACTION_LEFT_ARROW_PRESSED="KeyPressed = =LeftArrow",e.ACTION_RIGHT_ARROW_PRESSED="KeyPressed = =RightArrow",e.ACTION_ESC_PRESSED="KeyPressed = =Escape",e.ACTION_SHARE_CLICKED="ShareClicked",e.ACTION_SHARE_CHANNEL_CLICKED="ShareChannelClicked",e.ACTION_SLIDER_CLICKED="SliderClicked",e.ACTION_SLIDER_DRAGGED="SliderDragged",e.ACTION_SLIDER_DRAGGED_DISTANCE="SliderDragged::Distance",e.ACTION_OPEN_KCR="OpenKCR",e.ACTION_TEXT_ME="TextMe",e.ACTION_WISH_LIST_CLICKED="AddToWishListClicked",e.ACTION_DOWNLOAD_CHROME_CLICKED="DownloadChromeClicked",e.ACTION_DOWNLOAD_FIREFOX_CLICKED="DownloadFirefoxClicked",e.ACTION_DOWNLOAD_IE_CLICKED="DownloadIEClicked",e.ACTION_DOWNLOAD_SAFARI_CLICKED="DownloadSafariClicked",e.ACTION_BUY_BUTTON_CLICKED="BuyClicked",e.ACTION_GET_KINDLE_APP_CLICKED="GetKindleAppClicked",e.ACTION_SHOW_MORE_COLLAPSED_QUOTE="ShowMore = =Collapsed = =Quote",e.ACTION_SHOW_MORE_COLLAPSED_SYNOPSIS="ShowMore = =Collapsed = =Synopsis",e.ACTION_SHOW_MORE_EXPANDED_QUOTE="ShowMore = =Expanded = =Quote",e.ACTION_SHOW_MORE_EXPANDED_SYNOPSIS="ShowMore = =Expanded = =Synopsis",e.ACTION_CONDITIONS_OF_USE_CLICKED="ConditionsOfUseClicked",e.ACTION_PRIVACY_NOTICE_CLICKED="PrivacyNoticeClicked",e.ACTION_LEGAL_NOTICES_CLICKED="LegalNoticesClicked",e.ACTION_LOGOUT_CLICKED="LogoutClicked",e.ACTION_RETRY_CLICKED="RetryClicked",e.CONTEXT_NOTEBOOK_PAGE="NotebookPage",e.CONTEXT_NOTEBOOK_PAGE_EMPTY_LIB="NotebookPageEmptyLib",e.CONTEXT_NOTEBOOK_PAGE_EMPTY_ANNOTATIONS="NotebookPageEmptyAnnotations",e.CONTEXT_ERROR_ALERT="ErrorAlert",e.ACTION_NOTEBOOK_PAGE_ANNOTATIONS_LOAD_FAIL="NotebookPageAnnotationsLoadFail",e.ACTION_NOTEBOOK_PAGE_LIBRARY_LOAD_FAIL="NotebookPageLibraryLoadFail",e.ACTION_NOTEBOOK_SEARCH_SUBMITTED="NotebookSearchSubmitted",e.ACTION_NOTEBOOK_SEARCH_RESULTS_FOUND="NotebookSearchResultsFound",e.ACTION_DETAIL_PAGE_CLICKED="DetailPageUrlClicked",e.ACTION_OPEN_IN_KINDLE_TRIGGER="OpenInKindleTrigger",e.ACTION_OPEN_IN_KINDLE_SUCCESS="OpenInKindleSuccess",e.ACTION_OPEN_IN_KINDLE_FAIL="OpenInKindleFail",e.ACTION_HIGHLIGHT_DELETED="HighlightDeleted",e.ACTION_NOTE_DELETED="NoteDeleted",e.ACTION_NOTE_ADDED="NoteAdded",e.ACTION_NOTE_EDITED="NoteEdited",e.ACTION_HIGHLIGHTS_NOTES_COPY="HighlightsNotesCopy",e.ACTION_HIGHLIGHT_TRUNCATED="HighlightTruncated",e.ACTION_HIGHLIGHT_HIDDEN="HighlightHidden",e.ACTION_HIGHLIGHT_EMPTY_TEXT="HighlightEmptyText",e}();t.RSConstants=a;var s=function(){function e(){this.events=[],this.CONTEXT_CHANGE_IMMERSIVE_FOOTER="ReaderFontSizeChangeFooter",this.CONTEXT_CHANGE_IMMERSIVE_HEADER="ReaderChangeImmersiveHeader",this.CONTEXT_READER="Reader",this.CONTEXT_SHARING_DIALOG="SharingDialog",this.CONTEXT_JS_ERROR="JSError",this.ACTION_FONT_SIZE_CHANGE="FontSizeChange",this.ACTION_CONTENT_NOT_RENDERED_IN_TIME="BookContentNotRenderedInTime",this.ACTION_BUY_BUTTON_CLICKED="BuyClicked",this.ACTION_GET_KINDLE_APP_CLICKED="GetKindleAppClicked",this.ACTION_READ_IN_KINDLE_CLICKED="ReadInKindleClicked",this.ACTION_WISH_LIST_CLICKED="AddToWishListClicked",this.ACTION_VIEW_FULL_DETAILS_CLICKED="ViewFullDetailsClicked",this.ACTION_LEARN_MORE_CLICKED="LearnMoreClicked",this.ACTION_CLOSE_CLICKED="CloseClicked",this.ACTION_SHARE_CLICKED="ShareClicked",this.ACTION_SHARE_CHANNEL_CLICKED="ShareChannelClicked",this.SPAN_TYPE_TEXT="Text",this.ERROR_DP_URL_NOT_CONFIGURED="DetailPageUrlNotConfigured",this.UNHANDLED_REJECTION="UnhandledRejection",this.ACTION_SLIDER_CLICKED="SliderClicked",this.ACTION_SLIDER_DRAGGED="SliderDragged",this.ACTION_SLIDER_DRAGGED_DISTANCE="SliderDragged::Distance",this.ACTION_REGION_MAGNIFICATION_ACTIVATE="RegionMagnificationEnabled",this.ACTION_REGION_MAGNIFICATION_DEACTIVATE="RegionMagnificationDisabled",this.ACTION_REGION_MAGNIFICATION_FORWARD="RegionMagnificationForward",this.ACTION_REGION_MAGNIFICATION_BACKWARD="RegionMagnificationBackward"}return e.prototype.getEvents=function(){return this.events.slice(0)},e.prototype.clearEvents=function(e){var t=this.events;t.splice(0,e&&e<t.length?e:t.length)},e.prototype.addEvent=function(e){e.metadataMap.requestId=e.metadataMap.requestId||window.KindleGlobal.requestInfo.requestId,this.events.push(e)},e.prototype.consumeContentPoint=function(e,t,n,i,a){void 0===i&&(i={}),this.addEvent({type:o.ConsumeContentPoint,timestamp:a||Date.now(),context:e||r,pointType:t,position:Math.max(n||0,0),metadataMap:i})},e.prototype.consumeContentSpan=function(e,t,n,i,a,s){void 0===a&&(a={}),this.addEvent({type:o.ConsumeContentSpan,context:e||r,timestamp:s||Date.now(),spanType:t,startPosition:n,endPosition:i,metadataMap:a})},e.prototype.hideContext=function(e,t,n){void 0===t&&(t={}),this.addEvent({type:o.HideContext,context:e||r,timestamp:n||Date.now(),metadataMap:t})},e.prototype.openContent=function(e,t,n,i,r,a,s,d){void 0===s&&(s={}),this.addEvent({type:o.OpenContent,contentType:e,timestamp:d||Date.now(),asin:n,embeddedId:t,srl:i,erl:r,bookLength:a,metadataMap:s})},e.prototype.openContext=function(e,t,n,i){void 0===n&&(n={}),this.addEvent({type:o.OpenContext,openerContext:e||r,openedContext:t||r,timestamp:i||Date.now(),metadataMap:n})},e.prototype.performAction=function(e,t,n,i){void 0===n&&(n={}),this.addEvent({type:o.Action,context:e||r,actionId:t,timestamp:i||Date.now(),metadataMap:n})},e.prototype.performContentAction=function(e,t,n,i,a,s){void 0===a&&(a={}),this.addEvent({type:o.ContentAction,context:e||r,actionId:t,startPosition:n,endPosition:i,timestamp:s||Date.now(),metadataMap:a})},e.prototype.recordAuxContentState=function(e,t,n,i,r,a,s){void 0===a&&(a={}),this.addEvent({type:o.AuxContentState,auxContentType:e,supportsMainContent:t,hasData:n,isEnabled:i,supportsNoData:r,timestamp:s||Date.now(),metadataMap:a})},e.prototype.recordMetadata=function(e,t,n){this.addEvent({type:o.Metadata,context:e||r,timestamp:n||Date.now(),metadataMap:t})},e.prototype.recordSetting=function(e,t,n,i,a,s){void 0===a&&(a={}),this.addEvent({type:o.SettingState,context:e||r,settingId:t,state:n,isChange:i,timestamp:s||Date.now(),metadataMap:a})},e.prototype.showContext=function(e,t,n){void 0===t&&(t={}),this.addEvent({type:o.ShowContext,context:e||r,timestamp:n||Date.now(),metadataMap:t})},e}();t.Manager=s,t.getManager=n}),define("modules/utils/Config",["require","exports"],function(e,t){"use strict";function n(){return d}function i(){return u}function r(){var e={},t=window.location.search.substring(1),n=t.split("&");return n.forEach(function(t){var n=t.split("="),i=n[0],r=n.length>1?decodeURIComponent(n[1]):"";e[i]=r}),e}function o(){return a.serviceName||"KindlePlayer"}t.queryParameters=r();var a=window.KindleGlobal,s=a.srsBaseHref||"https://"+window.location.hostname+"/service/web/",d=s+"reader/",u=s+"content/";t.getAuthenticatedBaseServiceUrl=n,t.getUnauthenticatedBaseServiceUrl=i,t.appConfig={version:a.appStaticVersion,versionForRS:a.appVersionForReadingStreams,deviceCapabilityVersion:a.deviceCapabilityVersion},t.getMetricsProgram=o});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/utils/Errors",["require","exports"],function(e,t){"use strict";!function(e){e[e.GeneralLoggerInvalidPath=101]="GeneralLoggerInvalidPath",e[e.ReaderCreatePositionInvalidType=201]="ReaderCreatePositionInvalidType",e[e.ReaderViewInvalidActionInvoked=202]="ReaderViewInvalidActionInvoked",e[e.ReaderGetBookInfoUnknownFormat=203]="ReaderGetBookInfoUnknownFormat",e[e.ReaderMetadataImplUnknownFormat=204]="ReaderMetadataImplUnknownFormat"}(t.Codes||(t.Codes={}));var n=t.Codes,i=function(e){function t(t){if(e.call(this),this.message=t,this.name="KcrError",void 0===this.stack||""===this.stack)try{throw new Error}catch(n){this.stack=n.stack}}return __extends(t,e),t.prototype.setErrorCode=function(e){return this.errorCode=e,this},t.prototype.setCausedBy=function(e){return this.causedBy=e,this},t.prototype.toString=function(){return this.name+": "+(this.errorCode?"("+this.errorCode+" "+n[this.errorCode]+") ":"")+(this.message||"")},t}(Error);t.KcrError=i;var r=function(e){function t(t,n,i){e.call(this,t),this.message=t,this.url=n,this.status=i,this.name="HttpNetworkError"}return __extends(t,e),t.prototype.toString=function(){return e.prototype.toString.call(this)+" (URL="+this.url+"; HTTP status="+this.status+")"},t}(i);t.HttpNetworkError=r;var o=function(e){function t(t,n,i,r,o){e.call(this,t),this.message=t,this.url=n,this.jqXHR=i,this.textStatus=r,this.thrownError=o,this.name="JQueryAjaxError"}return __extends(t,e),t.prototype.toString=function(){return e.prototype.toString.call(this)+" (URL="+this.url+"; AJAX status="+this.textStatus+"; HTTP status="+this.jqXHR.status+"; HTTP error="+this.thrownError+")"},t}(i);t.JQueryAjaxError=o;var a=function(e){function t(t,n){e.call(this,t),this.message=t,this.rjsError=n,this.name="RequireJSError"}return __extends(t,e),t.prototype.toString=function(){var t=this.rjsError.requireModules&&this.rjsError.requireModules[0];return e.prototype.toString.call(this)+" (moduleName="+t+")"},t}(i);t.RequireJSError=a}),define("modules/utils/DeviceUtils",["require","exports","modules/utils/Errors"],function(e,t,n){"use strict";function i(){return-1!==G.indexOf("iPad")}function r(){return-1!==G.indexOf("iPhone")||-1!==G.indexOf("iPod")}function o(){return i()||r()}function a(){return!!G.match(/iPad;.*CPU.*OS 7_\d/i)}function s(){return!!G.match(/Android/i)}function d(){var e=!(!M.vendor||!M.vendor.match(/Amazon/i)),t=!(!G||!G.match(/KF[A-Z]{2}(WI|WA)/i));return s()&&(e||t)}function u(){return i()?"touchend":"click"}function c(){var e;if(o()?e=/OS\s(\d+)/i:s()&&(e=/Android\s(\d+(?:\.\d+)+)/i),e){var t=e.exec(G);if(t&&t.length>1)return parseInt(t[1],10)}throw new n.KcrError("Cannot get major version for the current user agent")}function l(){return!!G.match(/(Chrome|CriOS)/i)}function f(){return o()&&!C()&&!M.standalone}function p(){return G.indexOf("FB_IAB/FB4A")>=0}function E(){return s()&&(p()||m()||h()||!!window._cordovaNative||!!G.match(/WebView|; wv[;)]/i))}function _(){return f()||E()}function C(){return!!G.match(/Safari/i)}function h(){return!!G.match(/Twitter/i)}function m(){return!!G.match(/WhatsApp/i)}function g(){return window.KindleGlobal.deviceInfo&&window.KindleGlobal.deviceInfo.isDesktop}function T(){return!(o()||s()&&l())}function w(){return f()}function A(){return"ontouchstart"in window||!!M.msMaxTouchPoints}function O(){var e=window.KindleGlobal.deviceInfo;return e.name.toLowerCase().split(" ")[0]+"@"+e.version.split(".")[0]}function I(){return o()?"iOS":s()?"Android":g()?"Desktop":"Other"}function R(){return window.KindleGlobal.deviceInfo.deviceType}function N(){return p()}function S(){return C()&&o()?Math.min(window.innerHeight,$(window).height()):window.innerHeight}function v(){try{return o()&&7===c()}catch(e){return!1}}function D(){return-1!==G.indexOf("MSIE")||-1!==G.indexOf("Trident")}function k(){return-1!==G.indexOf("Firefox")}function L(){return!!G.match("Trident/[78].0")}function P(){return!!G.match("Edge/d+")}function y(){return D()||L()||P()}function b(){return L()}function U(){return D()}function K(){return D()}var M=window.navigator,G=M.userAgent;t.isIOS=o,t.isiPadiOS7=a,t.isAndroid=s,t.isFireOS=d,t.getClickEvent=u,t.getMobileOSMajorVersion=c,t.isChrome=l,t.isWebView=_,t.isSafari=C,t.isTwitter=h,t.isDesktop=g,t.requireDelayOnResize=T,t.shouldHideErrorDialogWhenNavigating=w,t.isTouchDevice=A,t.getBrowserWithMajorVersion=O,t.getDevicePlatform=I,t.getDeviceCategory=R,t.isFBOpenLinkWorkaroundNeeded=N,t.getWindowHeight=S,t.shouldSimulateClickForITunes=v,t.isFirefox=k,t.isMSBrowser=y,t.hasTransparentDivProblem=b,t.hasFullscreenCrashProblem=U,t.hasHammerSwipeClickBothFireProblem=K}),define("modules/utils/QueryParamUtils",["require","exports"],function(e,t){"use strict";function n(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?void 0:decodeURIComponent(n[1].replace(/\+/g," "))}function i(e,t){return t?e+(e.indexOf("?")<0?"?":"&")+t:e}function r(e,t){if(!t)return e;var n="";for(var i in t)n+=i+"="+t[i]+"&";return n.slice(0,-1),e+(e.indexOf("?")<0?"?":"&")+n}function o(e,t){var n=e.split("#",2),i=n[1],r=n[0].split("?",2),o=r[0],a=r[1]||"",s={};a.split("&").forEach(function(e){var t=e.split("=",2);2!==t.length||t[0]in s||(s[t[0]]=t[1])});var d;for(d in t){var u=t[d];null!==u&&void 0!==u?s[d]=t[d]:s[d]&&delete s[d]}a="";var c="?";for(d in s)a+=c+d+"="+s[d],c="&";return o+a+(i?"#"+i:"")}function a(e){return i(e,"sId="+window.KindleGlobal.requestInfo.sId)}t.getQueryParameter=n,t.appendQueryParams=i,t.appendQueryParamsMap=r,t.updateQueryParams=o,t.setSessionIdQueryParam=a}),define("modules/utils/RefTag",["require","exports","modules/utils/QueryParamUtils"],function(e,t,n){"use strict";function i(e){var n=window.KindleGlobal.requestInfo&&window.KindleGlobal.requestInfo.refTag;return n?n:e?e+a():t.Constants.NO_REFTAG}function r(e){return o(i(e))}function o(e){return u+"="+e}function a(){var e=window.KindleGlobal.error;switch(e){case"UNSUPPORTED_BROWSER":return"_ub";case"GEO_LOCATION_NOT_ALLOWED":case"CONTENT_NOT_ALLOWED":return"_ip";case"CONTENT_NOT_SUPPORTED":return"_uc";default:return""}}function s(e){return window.KindleGlobal.endpointRefTag&&e?window.KindleGlobal.endpointRefTag+e:null}function d(e){var t=i();if(!e||e===t){var r={};r[u]=void 0;var o=n.updateQueryParams(window.location.href,r);window.history.replaceState(o,"",o)}}t.Constants={GET_APP_READER_FOOTER_SUFFIX:"_gka_rf",NO_REFTAG:"k4w_no_ref",RIK_SUFFIX:"_rik",BUY_ACTION_ON_READER_HEADER_SUFFIX:"_store_rh",VIEW_DETAILS_ON_READER_HEADER_SUFFIX:"_details_rh",BUY_ACTION_ON_LANDING_PAGE_SUFFIX:"_store_lp",BUY_ACTION_ON_END_ACTION_SUFFIX:"_store_ea",VIEW_DETAILS_ON_LANDING_PAGE_SUFFIX:"_dp_lp",VIEW_DETAILS_ON_END_ACTION_SUFFIX:"_dp_ea",GET_APP_END_ACTION_SUFFIX:"_gka_ea",TEXT_ME_SUFFIX:"_text_me",RIK_DESKTOP_SUFFIX:"_rik_desktop",VIEW_DETAILS_ON_ERROR_DIALOG:"_details_error",K4W_KA_NOTEBOOK:"k4w_ka_notebook"};var u="ref_";t.getRefTag=i,t.getRefTagQueryParam=r,t.formatRefTagForQS=o,t.formatError=a,t.getEndpointRefTag=s,t.removeRefTagFromUrl=d}),define("modules/utils/StringUtils",["require","exports"],function(e,t){"use strict";function n(e,t,n){return e.replace(s,function(r,o){var a=t[o];if("undefined"==typeof t[o])throw new Error("Couldn't find value for key '"+o+"' in template '"+e+"'.");return n?i(a):a})}function i(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}function r(e){return $("<div/>").html(e).text()}function o(e){var t=new RegExp("\r\n","g"),n=new RegExp("\n","g");return i(e).replace(t,"<br/>").replace(n,"<br/>")}function a(e){var t=new RegExp("<br\\s*\\/?>","g"),n=e.replace(t,"\n");return r(n)}var s=/\${([\w_]+)}/g;t.format=n,t.escapeHTML=i,t.unescapeHTML=r,t.escapeAndFormatHTML=o,t.unescapeAndFormatHTML=a}),define("modules/utils/Utility",["require","exports","modules/utils/DeviceUtils","modules/metrics/MetricsUtils","modules/utils/QueryParamUtils","modules/metrics/ReadingStreams","modules/utils/RefTag","modules/utils/StringUtils"],function(e,t,n,i,r,o,a,s){"use strict";function d(e,t){var n=window;n.Kindle=n.Kindle||{},n.Kindle[e]=t}function u(){return window.KindleGlobal.requestInfo&&window.KindleGlobal.requestInfo.associateTag}function c(){var e=u();return e?"tag="+e:null}function l(){return window.KindleGlobal&&window.KindleGlobal.requestInfo?window.KindleGlobal.requestInfo.embedPreviewMode:void 0}function f(e,t){var n=a.getEndpointRefTag(t);e=r.appendQueryParams(e,a.getRefTagQueryParam(n));var i=c();i&&(e=r.appendQueryParams(e,i));var o=window.KindleGlobal.requestInfo;return o.linkCode&&(e=r.appendQueryParams(e,"linkCode="+o.linkCode)),o.linkType&&(e=r.appendQueryParams(e,"linkType="+o.linkType)),o.linkId&&(e=r.appendQueryParams(e,"linkId="+o.linkId)),e}function p(e){return s.format(window.KindleGlobal.readUrlTemplate,{path:e||""})}function E(e,t){var i=a.getRefTag(t),o=a.formatRefTagForQS(i);if(n.isIOS())o="ct="+i;else if(n.isAndroid()){var s=a.formatRefTagForQS(i),d=c();d&&(s+="&"+d),o="referrer="+encodeURIComponent("utm_source=kindle_player&utm_content="+encodeURIComponent(window.btoa(s)))}return r.appendQueryParams(e,o)}function _(e){var t=$("<a>",{href:e});t[0].click()}function C(e,t,n){function i(){var e=$(this).is(":hidden")?this.naturalHeight:$(this).height(),i=$(this).is(":hidden")?this.naturalWidth:$(this).width();O>e&&O>i?n&&n(this):t&&t(this)}e.load(i).each(function(){this.complete&&$(this).load()})}function h(e,t){window.open(e,"_blank",t||"")}function m(e,t,n){void 0===t&&(t=I);var i,r,o=!1;return function(){var a=n||this,s=Date.now();o||i&&!(s>=i+t)||(o=!0,e.apply(a,arguments),clearTimeout(r),r=setTimeout(function(){i=s,o=!1},t))}}function g(e,t,n){void 0===t&&(t=I);var i;return function(){var r=n||this,o=Date.now();(!i||o>=i+t)&&e.apply(r,arguments),i=o}}function T(){var e=window.location;return e.origin||e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")}function w(){var e=window.location.search;return e?-1!==e.indexOf("from=Bookcard"):!1}function A(e,t,n){!function(r){var a=o.getManager();if(!r)return void i.recordAction(n,a.ERROR_DP_URL_NOT_CONFIGURED);i.recordAction(n,a.ACTION_VIEW_FULL_DETAILS_CLICKED);var s=f(r,t);e?h(s):window.open(s,"_self","")}(window.KindleGlobal.bookDetailPageUrl)}var O=5,I=200;t.addToGlobalKindle=d,t.getAssociateTag=u,t.getEmbedPreviewMode=l,t.getAmazonAttributedUrl=f,t.getReadUrl=p,t.getAppStoreUrlWithRefTag=E,t.simulateClickForLink=_,t.checkImageLoaded=C,t.openInNewWindow=h,t.throttled=m,t.debounced=g,t.getOrigin=T,t.isFromBookCard=w,t.openBookDetails=A}),define("modules/metrics/PMET",["require","exports","modules/utils/Config","modules/utils/DeviceUtils","modules/utils/RefTag","modules/utils/Utility"],function(e,t,n,i,r,o){"use strict";function a(e){return e&&e.match(w)?e.replace(A,""):e}function s(){var e={};return e[T.Version]=n.appConfig.version,e[T.Browser]=i.getBrowserWithMajorVersion(),e[T.RefTag]=a(r.getRefTag()),e[T.AssociateTag]=o.getAssociateTag(),e[T.EmbedPreviewMode]=o.getEmbedPreviewMode(),e}function d(){return window.performance.now()}function u(){return N.slice(0)}function c(e){N.splice(0,e&&e<N.length?e:N.length)}function l(e,t){return void 0===t&&(t=!1),S[e]=new R(e,t),S[e]}function f(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];e.forEach(function(e){console.debug("Recorded metric:",JSON.stringify(e)),N.push(e),delete S[e.name]})}function p(e){return S[e]}function E(){v=d(),setTimeout(C,D)}function _(){return d()-v>k}function C(){if(_()){var e=0;for(var n in S){var i=S[n];e+=i.mainTimer.discardRunningTimers();for(var r in i.timers){var o=i.timers[r];e+=o.discardRunningTimers()}}f(l(t.Constants.SUSPEND_DETECTED));var i=l(t.Constants.DISCARDED_METRIC_TIMERS_AFTER_SUSPEND);i.mainCounter.increment(e+g),f(i),g=0,console.warn("Client exceeded suspend time threshold; discarded %d running metric timer(s)",e)}E()}function h(e){v=e}window.performance=window.performance||{},window.performance.now=window.performance.now||Date.now,t.Constants={BOOK_CONTENT_RENDERED:"BookContentRendered",LOCAL_CONTENT:"LocalContent",REMOTE_CONTENT:"RemoteContent",QUARTILE_STARTED:"QuartileStarted",SUSPEND_DETECTED:"SuspendDetected",DISCARDED_METRIC_TIMERS_AFTER_SUSPEND:"DiscardedMetricTimersAfterSuspend",NOTEBOOK_PAGE_LOADED:"NotebookPageLoaded",NOTEBOOK_PAGE_LIBRARY_LOADED:"NotebookPageLibraryLoaded",NOTEBOOK_PAGE_ANNOTATIONS_LOADED:"NotebookPageAnnotationsLoaded"};var m="::",g=0,T={OS:"OS",Browser:"Browser",Version:"Version",RefTag:"RefTag",AssociateTag:"AssociateTag",EmbedPreviewMode:"EmbedPreviewMode"},w=/^(cm_sw|k4w_oembed)/i,A=/_[^_]+$/i;t.getBreakdownMap=s;var O=function(){function e(e,t){void 0===t&&(t=0),this.name=e,this.count=t,this.count=t,this.breakdown=[]}return e.prototype.increment=function(e){return void 0===e&&(e=1),this.count+=e,this},e}();t.Counter=O;var I=function(){function e(e){this.name=e,this.time=0,this.count=0,this.started=[],this.breakdown=[]}return e.prototype.start=function(){return this.started.push(d()),this},e.prototype.stop=function(){return this.started.length>0?_()?(this.started.pop(),g++,console.warn("Discarded a running timer in Timer.stop() because client suspend was detected")):(this.time+=d()-this.started.pop(),this.count++):console.warn("Extra StopTimer called for timer: "+this.name),this},e.prototype.startTimer=function(){return this.start(),this},e.prototype.stopTimer=function(){return this.stop(),this},e.prototype.discardRunningTimers=function(){var e=this.started.length;return this.started=[],e},e.prototype.setTime=function(e){return this.time=e,this},e}();t.Timer=I;var R=function(){function e(e,t){void 0===t&&(t=!1),this.name=e,this.reportedName=e,this.counters={},this.timers={},this.breakdown=[],this.properties={},this.mainTimer=new I(this.name),t&&this.mainTimer.start(),this.mainCounter=new O(this.name)}return e.prototype.getSubTimer=function(e){return this.timers[e]=this.timers[e]||new I(e),this.timers[e]},e.prototype.getSubCounter=function(e){return this.counters[e]=this.counters[e]||new O(e),this.counters[e]},e.prototype.incrementSubCounter=function(e,t){return void 0===t&&(t=1),this.getSubCounter(e).increment(t),this},e.prototype.increment=function(){return this.mainCounter.increment(),this},e.prototype.startTimer=function(){return this.mainTimer.start(),this},e.prototype.stopTimer=function(){return this.mainTimer.stop(),this},e.prototype.appendToReportedName=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.reportedName+=m+e.join(m),this},e.prototype.setProperty=function(e,t){return this.properties[e]=t,this},e}();t.Metric=R;var N=[],S={};t.getNow=d,t.getMetrics=u,t.clearMetrics=c,t.createMetric=l,t.record=f,t.getMetric=p;var v,D=5e3,k=2e4;t.isSuspendDetected=_,t.checkForSuspend=C,t.setLastSuspendCheckTime=h,E()}),define("modules/utils/Service",["require","exports","modules/metrics/PMET","q","modules/utils/Config","modules/utils/Errors","jquery"],function(e,t,n,i,r,o,a){"use strict";function s(e){var t={url:e,dataType:"text json",converters:{"text json":function(e){var t=e.trim().replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/^.+?\((.+)\);$/,"$1");return a.parseJSON(t)}},timeout:3e4};return u(t)}function d(e,t,i,r,o){function s(e){console.debug("Ajax succeeded after retry."),t(e),n.record(n.createMetric("AjaxSuccessAfterRetry"))}function d(t){return function(r,u,c){return 0>=t?(i(r,u,c),void n.record(n.createMetric("AjaxErrorAfterRetry"))):void setTimeout(function(){console.debug("Retrying ajax request ("+t+" remaining)..."),a.ajax(e).done().then(s,d(t-1))},o)}}void 0===r&&(r=3),void 0===o&&(o=3e3),a.ajax(e).done().then(t,d(r))}function u(e){function t(e){r.resolve(e)}function n(t,n,i){r.reject(new o.JQueryAjaxError(e.serviceCall||"JQuery ajax error",e.url,t,n,i))}var r=i.defer();return d(e,t,n),r.promise}function c(e){var t={url:e.url,serviceCall:e.serviceCall,dataType:"json"};return t.beforeSend=function(e){return e.setRequestHeader("Amzn-Device-Type",h),!0},e.postData&&(t.type="POST",t.contentType="application/json",t.processData=!1,t.data=JSON.stringify(e.postData)),"undefined"!=typeof e.async&&(t.async=e.async),u(t)}function l(e){var t={url:e.url,serviceCall:e.serviceCall,dataType:"json"},n=window.KindleGlobal.srsDeviceToken;return t.beforeSend=function(e){return e.setRequestHeader("Amzn-Device-Type",h),e.setRequestHeader("X-ADP-Session-Token",n),!0},e.postData&&(t.type="POST",t.contentType="application/json",t.processData=!1,t.data=JSON.stringify(e.postData)),"undefined"!=typeof e.async&&(t.async=e.async),u(t)}function f(e){function t(){var t=e.useAuthenticated?m:g;return t+="startReading?asin="+e.asin,e.kindleSessionId&&(t+="&kindleSessionId="+e.kindleSessionId),e.contentVersion&&(t+="&contentVersion="+e.contentVersion),e.formatVersion&&(t+="&formatVersion="+e.formatVersion),void 0!==e.isSample&&(t+="&isSample="+(e.isSample?"true":"false")),window.KindleGlobal.capabilities.ALLOW_FULL_BOOK&&(t+="&checkSubscription=true"),t+=T,encodeURI(t)}return e.useAuthenticated?l({url:t(),serviceCall:"startReading"}):c({url:t(),serviceCall:"startReading"})}function p(e){function t(){var t=e.useAuthenticated?m:g;return t+="getFileUrl?asin="+e.asin,e.kindleSessionId&&(t+="&kindleSessionId="+e.kindleSessionId),e.contentVersion&&(t+="&contentVersion="+e.contentVersion),e.formatVersion&&(t+="&formatVersion="+e.formatVersion),void 0!==e.isSample&&(t+="&isSample="+(e.isSample?"true":"false")),e.skeletonIds&&(t+="&skeletonIds="+e.skeletonIds.join(",")),e.fragmentIds&&(t+="&fragmentIds="+e.fragmentIds.join(",")),e.glyphIds&&(t+="&glyphIds="+e.glyphIds.join(",")),e.resourceIds&&(t+="&resourceIds="+e.resourceIds.join(",")),e.locationMapIds&&(t+="&locationMapIds="+e.locationMapIds.join(",")),window.KindleGlobal.capabilities.ALLOW_FULL_BOOK&&(t+="&checkSubscription=true"),encodeURI(t)}return e.useAuthenticated?l({url:t(),serviceCall:"getFileUrl"}):c({url:t(),serviceCall:"getFileUrl"})}function E(e){function t(){var t=m;return t+="stillReading?asin="+e.asin,e.guid&&(t+="&guid="+encodeURIComponent(e.guid)),e.kindleSessionId&&(t+="&kindleSessionId="+e.kindleSessionId),e.lastPageRead&&(t+="&lastPageRead="+e.lastPageRead),e.localTimeOffset&&(t+="&localTimeOffset="+e.localTimeOffset),e.positionType&&(t+="&positionType="+encodeURIComponent(e.positionType)),window.KindleGlobal.capabilities.ALLOW_FULL_BOOK&&(t+="&checkSubscription=true"),t}return l({url:t(),serviceCall:"stillReading"})}function _(e){function t(){var t=m;return t+="doneReading?asin="+e.asin,e.guid&&(t+="&guid="+encodeURIComponent(e.guid)),e.kindleSessionId&&(t+="&kindleSessionId="+e.kindleSessionId),e.lastPageRead&&(t+="&lastPageRead="+e.lastPageRead),e.localTimeOffset&&(t+="&localTimeOffset="+e.localTimeOffset),e.positionType&&(t+="&positionType="+encodeURIComponent(e.positionType)),window.KindleGlobal.capabilities.ALLOW_FULL_BOOK&&(t+="&checkSubscription=true"),t}return l({url:t(),serviceCall:"doneReading"})}function C(t,n,i,r,a){function s(n){var d=n.requireModules,u=new Array;d.forEach(function(e){w.hasOwnProperty(e)||(w[e]=i);var t=w[e];if(0>=t)throw a&&a(n),new o.RequireJSError("Failed to require library '"+e+"' using RequireJS.",n);requirejs.undef(e),w[e]--,u.push(e)}),setTimeout(function(){console.debug("Retrying RequireJS requests..."),e(t,null,s)},r)}void 0===i&&(i=3),void 0===r&&(r=3e3),e(t,n,s)}var h=window.KindleGlobal.amazonDeviceType,m=r.getAuthenticatedBaseServiceUrl(),g=r.getUnauthenticatedBaseServiceUrl(),T="&clientVersion="+r.appConfig.deviceCapabilityVersion;t.qJsonpUsingAjax=s,t.qAjax=u,t.ajaxUnauthenticated=c,t.ajaxAuthenticated=l,t.startReading=f,t.getFileUrl=p,t.stillReading=E,t.doneReading=_;var w={};t.requireWithRetry=C}),define("modules/utils/ReaderViewLoader",["require","exports","modules/utils/Service"],function(e,t,n){"use strict";function i(e){n.requireWithRetry(["KindlePlayerLoader"],function(){n.requireWithRetry(["KindlePlayer"],function(t){e(t)})})}t.whenReaderReady=i}),define("modules/metrics/MetricsUtils",["require","exports","./PMET","./ReadingStreams","modules/errors/JqueryPromiseErrorHandler","modules/utils/Service","modules/utils/ReaderViewLoader"],function(e,t,n,i,r,o,a){"use strict";function s(e,t,r,o){void 0===r&&(r={}),void 0===o&&(o=null),n.record(n.createMetric(t).appendToReportedName(e)),i.getManager().performAction(e,t,r,o)}function d(e,t){void 0===t&&(t={}),n.record(n.createMetric("Viewed").appendToReportedName(e)),i.getManager().showContext(e,t)}function u(e){g=e}function c(){return g}function l(){return!T||"pending"!==T.state()&&"resolved"!==T.state()?(T=$.Deferred(),a.whenReaderReady(function(){o.requireWithRetry(["modules/metrics/ReadingStreams","modules/metrics/PMET","modules/metrics/MetricsUtils"],function(e,t,n){e&&e.getManager?T.resolve(e.getManager(),t,n):T.reject(new Error("Metrics Managers not properly loaded"))})}),T.promise()):T.promise()}function f(){return w?w.promise():(w=$.Deferred(),$(document).ready(function(){a.whenReaderReady(function(){o.requireWithRetry(["modules/metrics/UploadManager"],function(e){e.init(),w.resolve(e)})})}),w.promise())}function p(e,t){var n=$.Deferred();return s(e,t),f().then(function(e){e.uploadMetrics(!0),n.resolve()}),n.promise()}function E(e,t,n){l().then(function(i,r){i.showContext(e,t||{},n);var o=r.createMetric("Viewed").appendToReportedName(e);A[o.reportedName]||(r.record(o),A[o.reportedName]=1)},r.onPromiseRejected)}function _(e,t,n){l().then(function(i){i.hideContext(e,t||{},n)},r.onPromiseRejected)}function C(e,t){var n=$.Deferred();return l().always(function(i,r){var o=r.createMetric(e);t&&o.appendToReportedName(t),r.record(o),n.resolve()}),n.promise()}function h(e,t,n){l().then(function(i,r){"string"==typeof e&&(e=r.createMetric(e)),r.record(e),t.name=e.reportedName,i.recordMetadata(n,t)},r.onPromiseRejected)}function m(){return{timezoneOffset:(new Date).getTimezoneOffset()}}var g,T,w,A={};t.recordAction=s,t.recordViewShown=d,t.setCurrentContainerView=u,t.getCurrentContainerView=c,t.getManagers=l,t.recordActionAndUploadMetrics=p,t.recordShowContext=E,t.recordHideContext=_,t.recordPMET=C,t.recordPMETAndRSMetadata=h,t.getInitialRSMetadata=m}),define("modules/apps/kp/ViewManager",["require","exports","modules/errors/JqueryPromiseErrorHandler","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils"],function(e,t,n,i,r){"use strict";var o=function(){function e(){$(document).keydown(function(e){f?f.trigger&&f.trigger("handleKeyDown",[e]):l.trigger("handleKeyDown",[e])})}function t(e){e.attr("hidden","")}function o(e){e.removeAttr("hidden"),l=e,e.trigger("show");var t=d();r.recordShowContext(t),r.getManagers().then(function(e,n,i){i.setCurrentContainerView(t)},n.onPromiseRejected)}function a(e){f=e,f.show()
}function s(){f&&(f.hide(),f=void 0)}function d(){return l?p[l.attr("id")]:"UndefinedView"}function u(){return l}function c(){l&&t(l)}var l,f,p={LandingPageView:i.RSConstants.CONTEXT_KSHARE_LANDING_PAGE,ReaderView:i.RSConstants.CONTEXT_READER,EndActionView:i.RSConstants.CONTEXT_KSHARE_END_ACTION,CoverPageView:i.RSConstants.CONTEXT_COVER_PAGE,PDocQuoteSharePage:i.RSConstants.CONTEXT_PDOC_SHARE_PAGE};return{show:o,hide:t,showOverlay:a,hideOverlay:s,getCurrentViewRSContext:d,attachKeyHandlers:e,getCurrentView:u,hideCurrentView:c}}();return o}),define("modules/ui/helpers/HeightChecker",["require","exports","modules/apps/kp/ViewManager","modules/utils/Service","modules/utils/ReaderViewLoader"],function(e,t,n,i,r){"use strict";var o=function(){function e(){return n.getCurrentView().is(o)}function t(t){r.whenReaderReady(function(){i.requireWithRetry(["modules/utils/DeviceUtils"],function(n){function i(){a=n.getWindowHeight(),t.css("height",a+"px"),$(window).trigger("resize"),e()&&window.scrollTo(0,0)}function r(){e()&&window.scrollTo(0,0);var t=n.getWindowHeight();t!==a&&i(),o=setTimeout(r,1e3)}var o,a=window.innerHeight;n.isDesktop()||r()})})}var o="#ReaderView";return{start:t}}();return o}),define("modules/ui/helpers/Polyfill",["require","exports","modules/utils/Service","modules/utils/ReaderViewLoader"],function(e,t,n,i){"use strict";var r=function(){function e(){return-1!==navigator.userAgent.indexOf("iPad")}function t(){return-1!==navigator.userAgent.indexOf("iPhone")||-1!==navigator.userAgent.indexOf("iPod")}function r(){return e()||t()}function o(){return r()&&!a()&&!navigator.standalone}function a(){return!!navigator.userAgent.match(/Safari/i)}function s(){return!!navigator.userAgent.match(/FBAN\/FBIOS/i)}function d(){return!!navigator.userAgent.match(/FBAN\/MessengerForiOS/i)}function u(){return!!navigator.userAgent.match(/Twitter/i)}function c(){return s()?"facebook":u()?"twitter":d()?"facebookMessenger":"default"}function l(){var e=g.exec(navigator.userAgent);if(e){var t=e[1],n=e[2];return parseFloat(t+"."+n)}return null}function f(){if(!o())return!1;var e=l();return!(!e||e>=8.4)}function p(){r()&&$(".kp-book-panel-frame").addClass("kp-ios-double-border")}function E(){"iPhone OS"===m.osName&&($(document).on("touchmove",function(e){e.preventDefault()}),$(document).on("touchmove","#LandingPageView, #EndActionView",function(e){e.stopPropagation()}))}function _(){i.whenReaderReady(function(){n.requireWithRetry(["modules/utils/DeviceUtils"],function(e){e.isiPadiOS7()&&e.isSafari()&&$("#ReaderView").addClass("kp-ipad-ios7")})})}function C(e){if(o()){var t,n=c();t=n in T?T[n]:T["default"],$(e).css("padding-bottom",t+"px")}}function h(e){o()&&$(e).css("padding-bottom","0")}var m=window.KindleGlobal&&window.KindleGlobal.deviceInfo||{},g=/\bOS (\d+)_(\d+)(_\d+)?\b/gi,T={facebook:54,twitter:65,googlePlus:188,"default":0};return function(e){if("performance"in e==!1&&(e.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in e.performance==!1){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),e.performance.now=function(){return Date.now()-t}}}(window),{doubleBorder:p,preventBounce:E,normalizeLandscapeHeight:_,addPaddingForWebviewToolbars:C,removePaddingForWebviewToolbars:h,shouldAvoidPositionFixed:f}}();return r}),define("modules/ui/helpers/UIUtils",["require","exports","modules/apps/kp/ViewManager","modules/utils/Service","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils"],function(e,t,n,i,r,o){"use strict";var a=function(){function e(){d=d||$("#kp-kshare-spinner"),u=setTimeout(function(){d.show()},l)}function t(){clearTimeout(u),d=d||$("#kp-kshare-spinner"),d.hide()}function a(e){function t(e){$(e).attr("src",c)}e[0]&&i.requireWithRetry(["KindlePlayerLoader"],function(){i.requireWithRetry(["modules/utils/Utility"],function(n){n.checkImageLoaded(e,null,t)})})}function s(){$(document).on("doLogout",function(){o.recordActionAndUploadMetrics(n.getCurrentViewRSContext(),r.RSConstants.ACTION_LOGOUT_CLICKED),window.location.href=window.KindleGlobal.forceSigninUrl}),$(".kp-logout-link").click(function(){$(document).trigger("doLogout")})}var d,u,c="./img/img_alt_cover.png",l=200;return{showSpinner:e,hideSpinner:t,fixMissingImage:a,initLogoutLinks:s}}();return a}),define("modules/ui/widgets/KindleAppDownload",["require","exports","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils","modules/utils/RefTag","modules/utils/Utility","modules/utils/DeviceUtils"],function(e,t,n,i,r,o,a){"use strict";function s(e,t){t.find("#kp-get-kindle-app-button, #kp-get-kindle-app-link").click(function(){i.recordActionAndUploadMetrics(e,n.RSConstants.ACTION_GET_KINDLE_APP_CLICKED),d()})}function d(){var e=r.getEndpointRefTag(r.Constants.GET_APP_END_ACTION_SUFFIX),t=o.getAppStoreUrlWithRefTag(window.KindleGlobal.appStoreUrl,e);a.shouldSimulateClickForITunes()?o.simulateClickForLink(t):o.openInNewWindow(t)}t.initialize=s}),define("modules/sharing/ShareUtils",["require","exports"],function(){"use strict";var e=function(){function e(e,t){var i="https://"+window.location.hostname+"/kp/share/getShareUrl"+window.location.search;n(i,e,{kpShareUrl:e},"tinyUrl",t)}function t(e){var t="https://"+window.location.hostname+"/kp/share/getMailtoShareUrl"+window.location.search,i=window.KindleGlobal.basicShareUrl;n(t,i,{kpShareUrl:i,requestId:window.KindleGlobal.requestInfo.requestId},"mailtoUrl",e)}function n(e,t,n,r,o){i[t]?o(i[t]):$.getJSON(e,n,function(e){var n=e[r];i[t]=n,i[n]=n,o(n)})}var i={};return{fetchTinyShareUrl:e,fetchMailtoUrl:t}}();return e}),define("modules/ui/helpers/Swipe",["require","exports","modules/utils/Service"],function(e,t,n){"use strict";var i=function(){function e(e,r,o){n.requireWithRetry(["hammer"],function(n){var a=new n(e,{direction:n.DIRECTION_HORIZONTAL,velocity:i,threshold:t});a.on(r,o)})}var t=10,i=.01;return{register:e}}();return i}),define("modules/ui/views/EndActionView",["require","exports","modules/utils/Utility","modules/utils/RefTag","modules/ui/helpers/UIUtils","modules/ui/widgets/KindleAppDownload","modules/sharing/ShareUtils","modules/ui/helpers/Swipe","modules/utils/Service","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils","modules/utils/ReaderViewLoader"],function(e,t,n,i,r,o,a,s,d,u,c,l){"use strict";var f=function(){function e(){C.find("#kp-end-action-margin-left").click(function(){C.trigger("showReader"),c.recordAction(h,u.RSConstants.ACTION_END_ACTION_BACK_BUTTON_CLICKED)}),C.find("#kp-buy-button").click(function(){var e=window.KindleGlobal.buyUrl;if(e)if(c.recordActionAndUploadMetrics(h,u.RSConstants.ACTION_BUY_BUTTON_CLICKED),"miniGlance"===window.KindleGlobal.purchaseExperience){var t="width=950,height=585,toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left=0,top=0";n.openInNewWindow(n.getAmazonAttributedUrl(e,i.Constants.BUY_ACTION_ON_END_ACTION_SUFFIX),t)}else window.location.href=n.getAmazonAttributedUrl(e,i.Constants.BUY_ACTION_ON_END_ACTION_SUFFIX);else e=window.KindleGlobal.bookDetailPageUrl,e?(c.recordActionAndUploadMetrics(h,u.RSConstants.ACTION_BUY_BUTTON_CLICKED),n.openInNewWindow(n.getAmazonAttributedUrl(e,i.Constants.BUY_ACTION_ON_END_ACTION_SUFFIX))):c.recordAction(h,u.RSConstants.ERROR_DP_URL_NOT_CONFIGURED)}),C.find("#kp-ea-close-button").click(function(){C.trigger("showReader"),c.recordAction(h,u.RSConstants.ACTION_CLOSE_BUTTON_CLICKED)}),C.find("#kp-ea-share-button").click(function(){c.recordAction(h,u.RSConstants.ACTION_SHARE_CLICKED),C.trigger("showSharingDialog")}),C.find("#kp-share-link-input").click(function(){$(this).select()}),C.find(".kp-learn-more-button").click(function(){var e=window.KindleGlobal.bookDetailPageUrl;e?(c.recordActionAndUploadMetrics(h,u.RSConstants.ACTION_LEARN_MORE_CLICKED),window.open(n.getAmazonAttributedUrl(e,i.Constants.VIEW_DETAILS_ON_END_ACTION_SUFFIX),"_blank")):c.recordAction(h,u.RSConstants.ERROR_DP_URL_NOT_CONFIGURED)}),C.on("click",".kp-share-link",function(e){var t=$(e.target).data("channel");c.recordAction(h,u.RSConstants.ACTION_SHARE_CHANNEL_CLICKED,{channel:t}),c.recordPMET(u.RSConstants.ACTION_SHARE_CHANNEL_CLICKED,h+"::"+t)}),window.KindleGlobal.deviceInfo.isDesktop&&C.find(".kp-share-icon-facebook, .kp-share-icon-twitter").click(function(e){e.preventDefault();var t=$(e.target).data("channel");window.open($(e.target).attr("href"),t,"width=650 height=450")}),l.whenReaderReady(function(){o.initialize(h,C)}),C.find("#kp-view-details-link").click(function(){var e=window.KindleGlobal.bookDetailPageUrl;e?(c.recordActionAndUploadMetrics(h,u.RSConstants.ACTION_VIEW_FULL_DETAILS_CLICKED),n.openInNewWindow(n.getAmazonAttributedUrl(e,i.Constants.VIEW_DETAILS_ON_END_ACTION_SUFFIX))):c.recordAction(h,u.RSConstants.ERROR_DP_URL_NOT_CONFIGURED)})}function t(){C.find(".kp-textme-input, .kp-share-link-input").keydown(function(e){e.stopPropagation()}),C.on("handleKeyDown",function(e,t){switch(t.which){case 37:C.trigger("showReader"),c.recordAction(h,u.RSConstants.ACTION_LEFT_ARROW_PRESSED),t.preventDefault();break;default:return}})}function f(){function e(e){"swiperight"===e.type&&(C.trigger("showReader"),c.recordAction(h,u.RSConstants.ACTION_END_ACTION_SWIPE_RIGHT))}window.KindleGlobal.deviceInfo.isDesktop||s.register(C[0],"swiperight",e)}function p(){l.whenReaderReady(function(){d.requireWithRetry(["modules/utils/DeviceUtils"],function(e){e.isFireOS()&&C.find("#kp-end-action-get-kindle-app-section").hide()})})}function E(){if(!window.KindleGlobal.shouldHideSharing){var e=C.find("#kp-share-link-input");e.length>0&&(e.select(),a.fetchTinyShareUrl(e.val(),function(t){e.val(t),e.select()})),a.fetchMailtoUrl(function(e){C.find(".kp-share-icon-email").attr("href",e)})}}function _(n){C=n,C.on("show",E),r.fixMissingImage(C.find(".kp-book-panel-image")),p(),t(),e(),f()}var C,h=u.RSConstants.CONTEXT_KSHARE_END_ACTION;return{initialize:_}}();return f}),define("modules/ui/helpers/ShowMore",["require","exports"],function(){"use strict";var e=function(){function e(){}return e.apply=function(t,n){function i(){t.add(s).attr("data-expanded","1"),o(),t.trigger(e.EVENT_EXPANDED)}function r(){t.add(s).attr("data-expanded",null),o(),t.trigger(e.EVENT_COLLAPSED)}function o(){"1"===t.attr("data-expanded")||"1"===t.attr("data-showing-full")?t.css("max-height",""):t.css("max-height",n()+"px")}function a(){var i=n(),r=c.offset().top-t.offset().top;r-i<=e.COLLAPSED_EXPANDED_MIN_DELTA?t.add(s).attr("data-showing-full","1"):t.add(s).attr("data-showing-full",null),o()}if(0!==t.length){var s=t.next("div.kp-show-more-container"),d=s.find(".kp-show-more-expand-link"),u=s.find(".kp-show-more-collapse-link"),c=$("<span>").appendTo(t);d.click(i),u.click(r);var l,f=window.innerHeight,p=window.orientation;return $(window).on("resize",function(){clearTimeout(l),l=setTimeout(function(){var t=window.innerHeight,n=Math.abs(f-t);(p!==window.orientation||n>=e.UPDATE_ON_RESIZE_THRESHOLD)&&(f=t,p=window.orientation,a(),setTimeout(a,1))},this.DELAY_AFTER_RESIZE)}),a(),t[0].recalculateShowMore=function(){a(),f=window.innerHeight,p=window.orientation},t[0].expand=i,t[0].collapse=r,t}},e.DELAY_AFTER_RESIZE=67,e.COLLAPSED_EXPANDED_MIN_DELTA=32,e.UPDATE_ON_RESIZE_THRESHOLD=110,e.EVENT_COLLAPSED="showMoreCollapsed",e.EVENT_EXPANDED="showMoreExpanded",e}();return e}),define("modules/utils/ErrorHandler",["require","exports","modules/metrics/PMET","modules/utils/Errors","modules/utils/DeviceUtils","modules/metrics/ReadingStreams","q","modules/apps/kp/ViewManager"],function(e,t,n,i,r,o,a,s){"use strict";function d(e){var t=l(e);u(t,e),C(e)}function u(e,t){"string"==typeof t?c(e,t):t?c(e,t.message,t.url,t.lineNumber,t.columnNumber,t.stack):c(e,"Missing error object in logError()")}function c(e,t,n,i,r,o){if(!o)try{throw new Error}catch(a){o=a.stack}p(e||"JSError",t,n,i,r,o);var s=e+": "+t+" in "+n+" at "+i+":"+r+(o?"\nStack Trace: "+o:"");console.error(s),o||console.trace&&console.trace(),f(s)}function l(e){var t;return"string"==typeof e?t=e:e&&(t=e.toString()||e.name),t}function f(e){location.search.match(/[?&]alerterror=1(&|$)/)&&window.alert("string"==typeof e?e:JSON.stringify(e))}function p(e,t,i,r,o,a){var d=n.createMetric(m.CONTEXT_JS_ERROR),u={openerContext:s.getCurrentViewRSContext()};e&&(d.setProperty("ErrorName",e),u.errorName=e),t&&(d.setProperty("ErrorMessage",t),u.errorMessage=t),i&&(d.setProperty("ErrorURL",i),u.errorURL=i),r&&(d.setProperty("ErrorLineNumber",String(r)),u.errorLineNumber=r),o&&(d.setProperty("ErrorColumnNumber",String(o)),u.errorColumnNumber=o),a&&d.setProperty("ErrorStackTrace",a),n.record(d),m.recordMetadata(m.CONTEXT_JS_ERROR,u)}function E(){void 0!==console&&void 0!==console.warn&&a.nextTick(function(){var e=a.getUnhandledReasons(),t=e.length!==T.length;if(!t)for(var n=0;n<e.length;n++){var i=e[n];if(T[n]!==i){t=!0;break}}t&&(console.warn("REPORTING UNHANDLED REJECTIONS: (these might still get handled in the future)"),e.forEach(function(e){console.warn(e)}),T=e)})}function _(e){h=void 0===e?!1:!e}function C(e){h&&"undefined"!=typeof window.ErrorManager&&window.ErrorManager.show(window.KindleGlobal.capabilities.NATIVE_APP_WEBVIEW_ERROR?window.ErrorManager.ERRORS.NATIVE_ERROR:e instanceof i.JQueryAjaxError?window.ErrorManager.ERRORS.NETWORK_ERROR:window.ErrorManager.ERRORS.GENERIC_ERROR)}var h=!0,m=o.getManager();t.handleError=d,window.onerror=function(e,t,n,i,r){var o=l(r);return c(o,e,t,n,i,r&&r.stack),C(r),!0},a.longStackSupport=!0;var g=2e3,T=[];setInterval(E,g),r.shouldHideErrorDialogWhenNavigating()&&$(document).ready(function(){function e(){return _(),t.apply(window,arguments)}$("a[href^=http]").on("click",function(){_()});var t=window.open;window.open=e,document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&_(!1)})}),a.onerror=function(e){var t=l(e);u("Uncaught Q error ("+t+")",e)},t.showErrorDialog=C}),define("modules/ui/views/LandingPageView",["require","exports","modules/utils/RefTag","modules/utils/Utility","modules/ui/helpers/ShowMore","modules/ui/helpers/UIUtils","modules/ui/helpers/Swipe","modules/errors/JqueryPromiseErrorHandler","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils","../../utils/ErrorHandler"],function(e,t,n,i,r,o,a,s,d,u,c){"use strict";var l=function(){function e(){h.find("#kp-landing-close-button").click(function(){h.trigger("showReader"),u.recordAction(O,d.RSConstants.ACTION_CLOSE_BUTTON_CLICKED)}),h.find("#kp-landing-read-sample-button").click(function(){h.trigger("showReader"),u.recordAction(O,d.RSConstants.ACTION_PREVIEW_BOOK_BUTTON_CLICKED)}),h.find("#kp-landing-learn-more-button, .kp-learn-more-button").click(function(){var e=window.KindleGlobal.bookDetailPageUrl;e?(u.recordActionAndUploadMetrics(O,d.RSConstants.ACTION_LEARN_MORE_CLICKED),i.openInNewWindow(i.getAmazonAttributedUrl(e,n.Constants.VIEW_DETAILS_ON_LANDING_PAGE_SUFFIX))):u.recordAction(O,d.RSConstants.ERROR_DP_URL_NOT_CONFIGURED)}),h.find("#kp-buy-button").click(function(){var e=window.KindleGlobal.buyUrl;e?(u.recordActionAndUploadMetrics(O,d.RSConstants.ACTION_BUY_BUTTON_CLICKED),window.location.href=i.getAmazonAttributedUrl(e,n.Constants.BUY_ACTION_ON_LANDING_PAGE_SUFFIX)):(e=window.KindleGlobal.bookDetailPageUrl,e?(u.recordActionAndUploadMetrics(O,d.RSConstants.ACTION_BUY_BUTTON_CLICKED),i.openInNewWindow(i.getAmazonAttributedUrl(e,n.Constants.BUY_ACTION_ON_LANDING_PAGE_SUFFIX))):u.recordAction(O,d.RSConstants.ERROR_DP_URL_NOT_CONFIGURED))}),h.find("#kp-view-details-link, #kp-citation-link").click(function(){var e=window.KindleGlobal.bookDetailPageUrl;e?(u.recordActionAndUploadMetrics(O,d.RSConstants.ACTION_VIEW_FULL_DETAILS_CLICKED),i.openInNewWindow(i.getAmazonAttributedUrl(e,n.Constants.VIEW_DETAILS_ON_LANDING_PAGE_SUFFIX))):u.recordAction(O,d.RSConstants.ERROR_DP_URL_NOT_CONFIGURED)})}function t(){h.scroll(function(){I||u.getManagers().then(function(e){I||(e.performAction(O,d.RSConstants.ACTION_SCROLL),I=!0)},s.onPromiseRejected)})}function l(){h.on("handleKeyDown",function(e,t){switch(t.which){case 39:h.trigger("showReader"),u.recordAction(O,d.RSConstants.ACTION_RIGHT_ARROW_PRESSED);break;default:return}})}function f(e){e.find(".kp-conditions-of-use").click(function(){u.recordAction(O,d.RSConstants.ACTION_CONDITIONS_OF_USE_CLICKED)}),e.find(".kp-privacy-notice").click(function(){u.recordAction(O,d.RSConstants.ACTION_PRIVACY_NOTICE_CLICKED)}),e.find(".kp-legal-notices").click(function(){u.recordAction(O,d.RSConstants.ACTION_LEGAL_NOTICES_CLICKED)})}function p(){function e(e){"swipeleft"===e.type&&(h.trigger("showReader"),u.recordAction(O,d.RSConstants.ACTION_LANDING_PAGE_SWIPE_LEFT))}window.KindleGlobal.deviceInfo.isDesktop||a.register(h[0],"swipeleft",e)}function E(){function e(){var e=m.scrollHeight>m.clientHeight?"1":"0";h.attr("data-has-scrollbar",e)}window.KindleGlobal.deviceInfo.isDesktop&&(e(),$(window).resize(e))}function _(){function e(e){return $(window).height()*(e/100)}var t=[];t.push(r.apply($(".kp-sample-quote"),function(){return e(g)}),r.apply($(".kp-synopsis"),function(){return e(T)}),r.apply($(".kp-quote"),function(){return $(".kp-qslp-lp").length?Math.min(window.innerHeight,$(window).height())*A:w})),$(".kp-quote").on(r.EVENT_COLLAPSED,function(){u.recordAction(O,d.RSConstants.ACTION_SHOW_MORE_COLLAPSED_QUOTE)}),$(".kp-sample-quote, .kp-synopsis").on(r.EVENT_COLLAPSED,function(){u.recordAction(O,d.RSConstants.ACTION_SHOW_MORE_COLLAPSED_SYNOPSIS)}),$(".kp-quote").on(r.EVENT_EXPANDED,function(){u.recordAction(O,d.RSConstants.ACTION_SHOW_MORE_EXPANDED_QUOTE)}),$(".kp-sample-quote, .kp-synopsis").on(r.EVENT_EXPANDED,function(){u.recordAction(O,d.RSConstants.ACTION_SHOW_MORE_EXPANDED_SYNOPSIS)}),h.on("show",function(){t.forEach(function(e){e&&e[0].recalculateShowMore()})})}function C(n){try{h=n,m=h.find(".kp-landing-main")[0],o.fixMissingImage(h.find(".kp-book-panel-image")),_(),E(),f(h),e(),t(),l(),p()}catch(i){c.handleError(i)}}var h,m,g=60,T=60,w=768,A=.3,O=d.RSConstants.CONTEXT_KSHARE_LANDING_PAGE,I=!1;return{initLegalFooter:f,initialize:C}}();return l}),define("modules/apps/kp/ViewTransitions",["require","exports","modules/apps/kp/ViewManager","modules/ui/helpers/UIUtils"],function(e,t,n,i){"use strict";var r=function(){function e(){n.hideCurrentView(),n.show(l)}function t(){i.showSpinner(),n.show(f),l&&l.length>0&&n.hide(l),p&&p.length>0&&n.hide(p)}function r(){n.show(E)}function o(){n.show(_)}function a(e,t){n.hideCurrentView(),n.show(p),t?($("#kp-endAction-sampleEnd-continue-reading-text").hide(),$("#kp-endAction-sampleEnd-exceeded-sample-length").show()):($("#kp-endAction-sampleEnd-exceeded-sample-length").hide(),$("#kp-endAction-sampleEnd-continue-reading-text").show())}function s(){n.hideOverlay()}function d(e,t){t&&C.anchorTo(t),n.showOverlay(C)}function u(){var n=window.KindleGlobal.capabilities;n.LANDING_PAGE?e():t()}function c(n,i,r,o,c,h){n&&n.length>0&&(l=n,$(document).on("reachedBeginningOfBook",e)),i&&i.length>0&&(f=i,$(document).on("showReader",t)),r&&r.length>0&&(p=r,$(document).on("reachedEndOfBook",a)),o&&o.length>0&&(E=o,$(document).on("doneCoverPageAnimation",u)),c&&c.length>0&&(_=c),h&&(C=h,$(document).on("hideSharingDialog",s),$(document).on("showSharingDialog",d))}var l,f,p,E,_,C;return{initialize:c,showLandingPage:e,showReader:t,showEndAction:a,showCoverPage:r,showPDocSharePageElement:o}}();return r}),define("modules/utils/Localization",["require","exports","modules/utils/StringUtils"],function(e,t,n){"use strict";function i(e,t){var i=r[e];return t?n.format(i,t,!0):i}var r=window.KindleGlobal.localizedStrings;t.getLocalizedString=i}),define("modules/ui/widgets/Feedback",["require","exports","modules/utils/Localization"],function(e,t,n){"use strict";var i=function(){function e(){function e(e,t,n){t[n]=e[n]}function t(e,t){return new Array(t+1).join(e)}var n={};$.extend(n,window.KindleGlobal.deviceInfo),$.extend(n,window.KindleGlobal.requestInfo),e(window.KindleGlobal,n,"appStaticVersion"),e(window.KindleGlobal,n,"appVersionForReadingStreams"),e(window.KindleGlobal,n,"kindlePlayerVersion");var u="";return u+=f(o),u+=t("\n",a),u+=f(s)+"\n",u+=JSON.stringify(n),u+="\n\n"+f(d),i+="subject="+encodeURIComponent(f(r)),i+="&body="+encodeURIComponent(u)}function t(t){var n=($("<a></a>").addClass("kp-feedback-widget-toggle").text(f(u)).attr("href","#"),$("<a></a>").addClass("kp-feedback-widget-link").text(f(l)).attr("href",e())),i=$("<div></div>");if(i.html(f(c)),i.addClass("kp-feedback-widget"),i.append(n),i.click(function(){i.toggleClass("kp-open")}),"IE"===window.KindleGlobal.deviceInfo.name){var r=function(){t.append($('<iframe id="kp-mailto-hack" src="'+e()+'"/>').css("opacity",0)),$("#kp-mailto-hack").remove()};n.click(function(){return i.toggleClass("kp-open"),r(),!1})}else n.click(function(){i.toggleClass("kp-open")});t.append(i)}var i="mailto:k4w-beta-feedback@amazon.com?",r="kp-feedback-email-subject",o="kp-feedback-email-header",a=15,s="kp-feedback-email-debug-header",d="kp-feedback-email-closing",u="kp-feedback-widget-label",c="kp-feedback-widget-header",l="kp-feedback-widget-link",f=n.getLocalizedString;return{initialize:t}}();return i}),define("modules/ui/views/SharingDialog",["require","exports","modules/sharing/ShareUtils","modules/utils/DeviceUtils","modules/utils/Service","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils","modules/utils/ReaderViewLoader"],function(e,t,n,i,r,o,a,s){"use strict";var d=function(){function e(){function e(e){h.trigger("hideSharingDialog"),a.recordHideContext(o.RSConstants.CONTEXT_SHARING_DIALOG,{mechanism:e})}function t(){h.on("handleKeyDown",function(t,n){switch(n.which){case 27:e(o.RSConstants.ACTION_ESC_PRESSED);break;default:return}})}h||(h=$(A),T=h.find(O),w=$(R),s.whenReaderReady(function(){r.requireWithRetry(["modules/utils/DeviceUtils"],function(e){e.isWebView()&&h.find(I).hide()})}),h.find(".kp-close-icon").click(function(){e(o.RSConstants.ACTION_CLOSE_BUTTON_CLICKED)}),i.isFirefox()&&h.find(N).click(function(e){e.preventDefault();var t=$(N).attr("href");t&&(window.top.location.href=t)}),h.on("click",function(t){h.is(t.target)&&e(o.RSConstants.ACTION_OVERLAY_CLICKED)}),window.KindleGlobal.deviceInfo.isDesktop&&(h.find(".kp-share-icon-facebook, .kp-share-icon-twitter").click(function(e){e.preventDefault();var t=$(e.target).data("channel");window.open($(e.target).attr("href"),t,"width=650 height=450")}),t()),h.on("click",".kp-share-link",function(e){var t=o.RSConstants.CONTEXT_SHARING_DIALOG,n=o.RSConstants.ACTION_SHARE_CHANNEL_CLICKED,i=$(e.target).data("channel");a.recordAction(t,n,{channel:i}),a.recordPMET(n,t+"::"+i)}),h.find(R).on("click",function(e){$(e.target).select()}),u()&&p())}function t(){h&&(h.attr("hidden",1),a.recordPMET(o.RSConstants.ACTION_CLOSE_BUTTON_CLICKED,o.RSConstants.CONTEXT_SHARING_DIALOG))}function d(){h||e(),h.attr("hidden")&&(h.removeAttr("hidden"),a.recordShowContext(o.RSConstants.CONTEXT_SHARING_DIALOG),w.select(),_(),u()&&(E(),f()))}function u(){return window.KindleGlobal.deviceInfo.isDesktop}function c(t){u()&&(h||e(),g=$(t),m=$("<div>").addClass(D),h.attr(S,"true"),h.append(m))}function l(e){var t=e.offset();return t.top+=e.outerHeight()+k,t.left+=e.outerWidth()/2,t.right=$(window).width()-t.left,t}function f(){if(!g)return this;var e=l(g);m.css({top:Math.round(e.top)+"px",right:Math.round(e.right)+"px"}),e.right=Math.max(e.right-T.width()/2,v),T.css({right:Math.round(e.right)+"px",top:Math.round(e.top)+"px"})}function p(){function e(e){clearTimeout(t),t=setTimeout(n,e)}var t,n=function(){$(window).width()>=L&&f()};$(window).on("resize",function(){e(P)})}function E(){n.fetchTinyShareUrl(w.val(),function(e){w.val(e),w.select()})}function _(){n.fetchMailtoUrl(function(e){h.find(".kp-share-icon-email").attr("href",e)})}function C(e,t){h.trigger(e,t)}var h,m,g,T,w,A="#kp-share-overlay-container",O="#kp-share-overlay",I=".kp-share-system-msg",R=".kp-share-link-input",N=".kp-share-icon-email",S="data-is-popover",v=20,D="kp-share-popover-arrow",k=10,L=600,P=50;return{show:d,hide:t,anchorTo:c,trigger:C}}();return d}),define("modules/ui/views/QuoteShareLandingPageView",["require","exports","modules/ui/helpers/Polyfill","modules/ui/helpers/ShowMore","modules/ui/helpers/HeightChecker","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils","../../utils/ErrorHandler"],function(e,t,n,i,r,o,a,s){"use strict";var d=function(){function e(e){try{if(c=$(".kp-qslp-lp"),l=c.find("#kp-landing-main"),c.length<1)return;f=c.find(".kp-qslp-reader-overlay"),_=c.find(".kp-quote"),p=c.find(".kp-qslp-primary-button-fixed"),E=c.find(".kp-qslp-primary-button-hidden"),f.click(function(){e.trigger("showReader"),a.recordAction(C,o.RSConstants.ACTION_CLOSE_BUTTON_CLICKED)}),t()}catch(n){s.handleError(n)}}function t(){n.shouldAvoidPositionFixed()&&(n.addPaddingForWebviewToolbars(l),d(),_.on(i.EVENT_EXPANDED,function(){u(),n.removePaddingForWebviewToolbars(l)}),_.on(i.EVENT_COLLAPSED,function(){d(),n.addPaddingForWebviewToolbars(l)}),c.css("bottom","0"),r.start(c))}function d(){p.attr("hidden","true"),E.removeAttr("hidden")}function u(){p.removeAttr("hidden"),E.attr("hidden","true")}var c,l,f,p,E,_,C=o.RSConstants.CONTEXT_KSHARE_LANDING_PAGE;return{initialize:e}}();return d}),define("modules/apps/kp/ReaderViewInitializer",["require","exports","modules/ui/helpers/UIUtils","modules/ui/helpers/Polyfill","modules/utils/Service","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils"],function(e,t,n,i,r,o,a){"use strict";var s=function(){function e(){function e(){setTimeout(function(){window.scrollTo(0,0)},0)}r.requireWithRetry(["KindlePlayerLoader"],function(){r.requireWithRetry(["KindlePlayer"],function(e){n.hideSpinner(),e.onShow()})}),e()}function t(e,t,n,i,r){r&&"gotoPositionFromRenderer"===i&&a.recordAction(o.RSConstants.CONTEXT_READER,o.RSConstants.ACTION_NAVIGATION_ATTEMPT_PAST_BOOK_END)}function s(n){d=n,d.on("show",e),d.on("click",function(e){d[0].hasAttribute("hidden")&&(d.trigger("showReader"),e.stopImmediatePropagation())}),d.on("navigatedToPercentage",t),i.normalizeLandscapeHeight()}var d;return{initialize:s}}();return s}),define("modules/ui/views/CoverPageView",["require","exports"],function(){"use strict";var e=function(){function e(){var e=$(n.find(".kp-cover-page-view")[0]);e.addClass("kp-cover-page-fade-in"),setTimeout(function(){e.removeClass("kp-cover-page-fade-in"),setTimeout(function(){n.fadeOut({complete:function(){$(n).trigger("doneCoverPageAnimation"),$("#ReaderView").addClass("with-overlay")}})},o)},i+r)}function t(t){n=t,n.on("show",function(){e()})}var n,i=400,r=600,o=500;return{initialize:t}}();return e}),define("modules/metrics/CSM",["require","exports"],function(e,t){"use strict";function n(e){window.ue&&window.ue.tag(e)}function i(){a(window.uet,"cf",s)}function r(){a(window.uet,"bb",s)}function o(){a(window.uex,"ld",s)}function a(e,t,n){"function"==typeof e&&e(t,n,{wb:1})}var s="KindlePlayerCriticalFeature";t.registerTag=n,t.logCriticalFeatureMarker=i,t.logBodyBeginMarker=r,t.uploadCSM=o}),define("modules/ui/views/PDocQuoteShareLandingPageView",["require","exports","modules/ui/widgets/KindleAppDownload","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils"],function(e,t,n,i,r){"use strict";var o=function(){function e(e){e.find(".kp-conditions-of-use").click(function(){r.recordAction(o,i.RSConstants.ACTION_CONDITIONS_OF_USE_CLICKED)}),e.find(".kp-privacy-notice").click(function(){r.recordAction(o,i.RSConstants.ACTION_PRIVACY_NOTICE_CLICKED)}),e.find(".kp-legal-notices").click(function(){r.recordAction(o,i.RSConstants.ACTION_LEGAL_NOTICES_CLICKED)})}function t(t){a=t,e(a)}var o=i.RSConstants.CONTEXT_PDOC_SHARE_PAGE;n.initialize(o,$("#kp-pdoc-get-kindle-app"));var a;return{initLegalFooter:e,initialize:t}}();return o}),define("modules/errors/ErrorManager",["require","exports","modules/apps/kp/ViewManager","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils","modules/utils/Utility","modules/utils/RefTag"],function(e,t,n,i,r,o,a){"use strict";var s=function(){function e(e){return window.KindleGlobal.localizedStrings[e]}function t(e){return e&&e.messageStringId||(e=O.GENERIC_ERROR),e.retriable=e.retriable!==!1?!0:!1,e.detailPageLink=e.detailPageLink!==!1?!0:!1,e.closeButton=e.closeButton!==!1?!0:!1,e}function s(){var e=document.createElement("div");e.setAttribute("hidden",""),e.className=p,e.id=_;var t=document.createElement("div");return t.className=E,e.appendChild(t),document.body.appendChild(e),e}function d(e,t){e.appendChild(document.createTextNode(t))}function u(){var t=document.createElement("a");return d(t,e(A)),t.setAttribute("href",window.location.href),t.onclick=function(){location.reload(),r.recordAction(i.RSConstants.CONTEXT_ERROR_DIALOG,i.RSConstants.ACTION_RETRY_CLICKED)},t}function c(){var t=document.createElement("a");return"PeriodicalPage"===window.KindleGlobal.page?d(t,window.KindleGlobal.viewPeriodicalDetailsString):d(t,e(T)),t.onclick=function(){I&&window.parent.location.reload(),o.openBookDetails(I,a.Constants.VIEW_DETAILS_ON_ERROR_DIALOG,i.RSConstants.CONTEXT_ERROR_DIALOG),r.recordAction(i.RSConstants.CONTEXT_ERROR_DIALOG,i.RSConstants.ACTION_VIEW_FULL_DETAILS_CLICKED)},t}function l(t){var n=document.createElement("a");return n.setAttribute("id",m),n.setAttribute("href","#"),d(n,e(g)),n.onclick=function(e){e.preventDefault(),r.recordAction(i.RSConstants.CONTEXT_ERROR_DIALOG,i.RSConstants.ACTION_CLOSE_BUTTON_CLICKED),t.close()},n}function f(o){o=t(o);var a=document.getElementById(_)||s(),f=a.hasAttribute("hidden"),p=[];if(f){for(var E=a.getElementsByClassName("kp-error-dialog")[0];null!==E.firstChild;)E.removeChild(E.firstChild);var m=document.createElement("p");d(m,e(o.messageStringId)),E.appendChild(m);var g=document.createElement("div");if(g.style.width="100%",g.style.display="table",E.appendChild(g),o.retriable){var T=u();p.push(T)}if(o.detailPageLink&&"PDOC"!==window.KindleGlobal.asin){var w=c();p.push(w)}var A="ReaderWebview"in window?window.ReaderWebview:{};if(o.closeButton&&"function"==typeof A.close){var O=l(A);p.push(O)}for(var I=0;I<p.length;I++){var R=p[I];1===p.length?R.className=h:I<p.length-1&&(R.className=C),g.appendChild(R)}a.removeAttribute("hidden"),r.recordShowContext(i.RSConstants.CONTEXT_ERROR_DIALOG,{errorType:o.metricName,openerContext:n.getCurrentViewRSContext()})}}var p="kp-error-dialog-container",E="kp-error-dialog",_="kp-error-dialog",C="kp-error-dialog-button-divider",h="kp-error-dialog-center",m="kp-error-closeWindow",g="kp-wl-confirmation-close",T="kp-error-dialog-view-details-button",w="inline",A="kp-error-dialog-retry-button",O={GENERIC_ERROR:{messageStringId:"kp-error-dialog-generic-error-message",retriable:!0,detailPageLink:!0,closeButton:!1,metricName:"GenericError"},NETWORK_ERROR:{messageStringId:"kp-error-dialog-network-error-message",retriable:!1,detailPageLink:!0,closeButton:!1,metricName:"NetworkError"},NATIVE_ERROR:{messageStringId:"kp-error-dialog-generic-error-message",retriable:!0,detailPageLink:!1,closeButton:!0,metricName:"NativeError"}};Object.freeze(O);var I=o.getEmbedPreviewMode()===w;return{ERRORS:O,show:f}}();return window.ErrorManager=s,s}),define("modules/apps/kp/Bootstrapper",["require","exports","modules/ui/helpers/HeightChecker","modules/ui/helpers/Polyfill","modules/utils/QueryParamUtils","modules/ui/views/EndActionView","modules/ui/views/LandingPageView","modules/apps/kp/ViewManager","modules/ui/helpers/UIUtils","modules/apps/kp/ViewTransitions","modules/ui/widgets/Feedback","modules/ui/views/SharingDialog","modules/ui/views/QuoteShareLandingPageView","modules/apps/kp/ReaderViewInitializer","modules/ui/views/CoverPageView","modules/errors/JqueryPromiseErrorHandler","modules/utils/Service","modules/metrics/ReadingStreams","modules/metrics/MetricsUtils","modules/utils/ReaderViewLoader","modules/metrics/CSM","modules/ui/views/PDocQuoteShareLandingPageView","modules/utils/ErrorHandler","modules/errors/ErrorManager"],function(e,t,n,i,r,o,a,s,d,u,c,l,f,p,E,_,C,h,m,g,T,w){"use strict";function A(){function e(e){m.getManagers().then(function(t){var n=m.getInitialRSMetadata();
t.recordMetadata(h.RSConstants.CONTEXT_PAGE_LOADED,n,e)},_.onPromiseRejected)}function t(){return!!r.getQueryParameter("showFeedback")}function A(){window.history.replaceState&&g.whenReaderReady(function(){C.requireWithRetry(["modules/utils/DeviceUtils"],function(e){e.isIOS()&&e.isChrome()||window.history.replaceState(void 0,void 0,r.updateQueryParams(window.location.href,{reshareId:window.KindleGlobal.requestInfo.requestId,reshareChannel:R,displayShareJIT:void 0}))})})}function O(){T.logBodyBeginMarker(),e(Date.now()),m.recordPMET(h.RSConstants.CONTEXT_PAGE_LOADED),I(),window.KindleGlobal.capabilities.ALLOW_FULL_BOOK||A()}function I(){var e,r,_,C,h,m=window.KindleGlobal.capabilities;m.COVER_PAGE&&(e=$("#CoverPageView"),E.initialize(e)),m.LANDING_PAGE&&(r=$("#LandingPageView"),a.initialize(r),f.initialize(r)),m.READER&&(_=$("#ReaderView"),p.initialize(_),n.start(_)),m.END_ACTION&&(C=$("#EndActionView"),o.initialize(C)),m.PDOC_SHARE_PAGE&&(h=$("#PDocQuoteSharePage"),w.initialize(h)),u.initialize(r,_,C,e,h,l),m.COVER_PAGE?u.showCoverPage():m.LANDING_PAGE?u.showLandingPage():m.READER?u.showReader():m.PDOC_SHARE_PAGE&&u.showPDocSharePageElement(),i.doubleBorder(),i.preventBounce(),d.initLogoutLinks(),s.attachKeyHandlers(),t()&&c.initialize($(document.body))}var R="system";$(document).ready(O)}t.init=A});